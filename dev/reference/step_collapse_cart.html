<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Supervised Collapsing of Factor Levels — step_collapse_cart • embed</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Supervised Collapsing of Factor Levels — step_collapse_cart"><meta name="description" content="step_collapse_cart() creates a specification of a recipe step that can
collapse factor levels into a smaller set using a supervised tree."><meta property="og:description" content="step_collapse_cart() creates a specification of a recipe step that can
collapse factor levels into a smaller set using a supervised tree."><meta property="og:image" content="https://embed.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="embed.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">embed</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Applications/GLM.html">Using Generalized Linear Models</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/Tensorflow.html">Entity Embeddings of Categorical Variables using TensorFlow</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/embed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Supervised Collapsing of Factor Levels</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/embed/blob/main/R/collapse_cart.R" class="external-link"><code>R/collapse_cart.R</code></a></small>
      <div class="d-none name"><code>step_collapse_cart.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>step_collapse_cart()</code> creates a <em>specification</em> of a recipe step that can
collapse factor levels into a smaller set using a supervised tree.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">step_collapse_cart</span><span class="op">(</span></span>
<span>  <span class="va">recipe</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  role <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  trained <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cost_complexity <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  min_n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  results <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  skip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  id <span class="op">=</span> <span class="fu">rand_id</span><span class="op">(</span><span class="st">"step_collapse_cart"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-recipe">recipe<a class="anchor" aria-label="anchor" href="#arg-recipe"></a></dt>
<dd><p>A recipe object. The step will be added to the sequence of
operations for this recipe.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>One or more selector functions to choose which variables are
affected by the step. See <a href="https://recipes.tidymodels.org/reference/selections.html" class="external-link">recipes::selections</a> for more details. For the <code>tidy</code>
method, these are not currently used.</p></dd>


<dt id="arg-role">role<a class="anchor" aria-label="anchor" href="#arg-role"></a></dt>
<dd><p>Not used by this step since no new variables are created.</p></dd>


<dt id="arg-trained">trained<a class="anchor" aria-label="anchor" href="#arg-trained"></a></dt>
<dd><p>A logical to indicate if the quantities for preprocessing have
been estimated.</p></dd>


<dt id="arg-outcome">outcome<a class="anchor" aria-label="anchor" href="#arg-outcome"></a></dt>
<dd><p>A call to <code>vars</code> to specify which variable is used as the
outcome to train CART models in order to pool factor levels.</p></dd>


<dt id="arg-cost-complexity">cost_complexity<a class="anchor" aria-label="anchor" href="#arg-cost-complexity"></a></dt>
<dd><p>A non-negative value that regulates the complexity of
the tree when pruning occurs. Values near 0.1 usually correspond to a tree
with a single splits. Values of zero correspond to unpruned tree.</p></dd>


<dt id="arg-min-n">min_n<a class="anchor" aria-label="anchor" href="#arg-min-n"></a></dt>
<dd><p>An integer for how many data points are required to make further
splits during the tree growing process. Larger values correspond to less
complex trees.</p></dd>


<dt id="arg-results">results<a class="anchor" aria-label="anchor" href="#arg-results"></a></dt>
<dd><p>A list of results to convert to new factor levels.</p></dd>


<dt id="arg-skip">skip<a class="anchor" aria-label="anchor" href="#arg-skip"></a></dt>
<dd><p>A logical. Should the step be skipped when the recipe is baked by
<a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">recipes::bake</a>? While all operations are baked when <a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">recipes::prep</a> is run, some
operations may not be able to be conducted on new data (e.g. processing the
outcome variable(s)). Care should be taken when using <code>skip = TRUE</code> as it
may affect the computations for subsequent operations</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>A character string that is unique to this step to identify it.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated recipe step.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This step uses a CART tree (classification or regression) to group the
existing factor levels into a potentially smaller set. It changes the levels
in the factor predictor (and the <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> method can be used to understand
the translation).</p>
<p>There are a few different ways that the step will not be able to collapse
levels. If the model fails or, if the results have each level being in its
own split, the original factor levels are retained. There are also cases
where there is "no admissible split" which means that the model could not
find any signal in the data.</p>
    </div>
    <div class="section level2">
    <h2 id="tidying">Tidying<a class="anchor" aria-label="anchor" href="#tidying"></a></h2>
    <p>When you <code><a href="https://recipes.tidymodels.org/reference/tidy.recipe.html" class="external-link">tidy()</a></code> this step, a tibble is returned with
columns <code>terms</code>, <code>old</code>, <code>new</code>, and <code>id</code>:</p>
<dl><dt>terms</dt>
<dd><p>character, the selectors or variables selected</p></dd>

<dt>old</dt>
<dd><p>character, the old levels</p></dd>

<dt>new</dt>
<dd><p>character, the new levels</p></dd>

<dt>id</dt>
<dd><p>character, id of this step</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="case-weights">Case weights<a class="anchor" aria-label="anchor" href="#case-weights"></a></h2>



<p>The underlying operation does not allow for case weights.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="step_collapse_stringdist.html">step_collapse_stringdist()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">ames</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rec</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">step_collapse_cart</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">Sale_Type</span>, <span class="va">Garage_Type</span>, <span class="va">Neighborhood</span>,</span></span>
<span class="r-in"><span>    outcome <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">rec</span>, number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 45 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    terms     old     new         id                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> Sale_Type <span style="color: #949494;">"</span>ConLD<span style="color: #949494;">"</span> Sale_Type_1 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> Sale_Type <span style="color: #949494;">"</span>ConLw<span style="color: #949494;">"</span> Sale_Type_1 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> Sale_Type <span style="color: #949494;">"</span>Oth<span style="color: #949494;">"</span>   Sale_Type_1 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> Sale_Type <span style="color: #949494;">"</span>COD<span style="color: #949494;">"</span>   Sale_Type_2 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> Sale_Type <span style="color: #949494;">"</span>VWD<span style="color: #949494;">"</span>   Sale_Type_2 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> Sale_Type <span style="color: #949494;">"</span>ConLI<span style="color: #949494;">"</span> Sale_Type_3 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> Sale_Type <span style="color: #949494;">"</span>WD <span style="color: #949494;">"</span>   Sale_Type_4 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> Sale_Type <span style="color: #949494;">"</span>CWD<span style="color: #949494;">"</span>   Sale_Type_5 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> Sale_Type <span style="color: #949494;">"</span>Con<span style="color: #949494;">"</span>   Sale_Type_6 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> Sale_Type <span style="color: #949494;">"</span>New<span style="color: #949494;">"</span>   Sale_Type_7 step_collapse_cart_EdLie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 35 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer></body></html>

